# AWS月額費用見積もり

## システム概要
テストケース自動手順生成システムのAWS ECS構成における月額費用見積もり

## 前提条件

| 項目 | 設定値 |
|------|--------|
| **リージョン** | 東京（ap-northeast-1） |
| **為替レート** | 1USD = 150円 |
| **運用フェーズ** | MVP段階（社内限定） → Phase 2（外部公開） |
| **稼働時間** | 24時間365日 |

## 主要コンポーネント別費用詳細

### 1. EC2インスタンス（GPU対応）

#### インスタンスタイプ: g4dn.xlarge
```
仕様:
- vCPU: 4
- メモリ: 16 GiB  
- GPU: NVIDIA T4 × 1
- ネットワーク: 最大25 Gbps
```

| 費用項目 | 単価 | 計算 | 月額（USD） | 月額（円） |
|----------|------|------|-------------|-----------|
| インスタンス料金 | $0.526/時間 | $0.526 × 24 × 30 | $378.72 | **56,808円** |

**選定理由**: Ollama推論にGPU必須、g4dn.xlarge以上が推奨される

### 2. EBSボリューム（永続ストレージ）

#### ボリュームタイプ: GP3 SSD（暗号化有効）
```
容量: 100GB（Ollamaモデルファイル用）
用途: /root/.ollama マウントポイント
```

| 費用項目 | 単価 | 計算 | 月額（USD） | 月額（円） |
|----------|------|------|-------------|-----------|
| ストレージ料金 | $0.08/GB | $0.08 × 100GB | $8.00 | 1,200円 |
| スナップショット | $0.05/GB | $0.05 × 100GB | $5.00 | 750円 |
| **小計** | - | - | **$13.00** | **1,950円** |

### 3. Application Load Balancer

#### ALB構成
```
MVP段階: HTTP:80（社内限定）
Phase 2: HTTPS:443（外部公開、ACM連携）
```

| 費用項目 | 単価 | 計算 | 月額（USD） | 月額（円） |
|----------|------|------|-------------|-----------|
| ALB基本料金 | $0.0225/時間 | $0.0225 × 720 | $16.20 | 2,430円 |
| LCU料金（最小） | - | - | $3.00 | 450円 |
| **小計** | - | - | **$19.20** | **2,880円** |

### 4. CloudWatch Logs

#### ロググループ構成
```
- FastAPI: /aws/ecs/fastapi-app
- Ollama: /aws/ecs/ollama-server  
- ALB: /aws/loadbalancer/app
保持期間: 30日
```

| 費用項目 | 単価 | 想定量 | 月額（USD） | 月額（円） |
|----------|------|--------|-------------|-----------|
| ログ取り込み | $0.50/GB | 10GB | $5.00 | 750円 |

### 5. その他AWSサービス

| サービス | 想定使用量 | 月額（USD） | 月額（円） |
|----------|-----------|-------------|-----------|
| ECR | 1GB | $0.10 | 15円 |
| Secrets Manager | 5シークレット | $2.00 | 300円 |
| SSM Parameter Store | 標準パラメータ | $0.00 | 0円 |
| データ転送（社内） | 100GB | $5.00 | 750円 |
| **小計** | - | **$7.10** | **1,065円** |

## 月額費用サマリー

### MVP段階（社内限定運用）

| コンポーネント | 月額（円） | 構成比 |
|----------------|-----------|--------|
| EC2（g4dn.xlarge） | 56,808円 | 89.4% |
| EBS Volume | 1,950円 | 3.1% |
| Application Load Balancer | 2,880円 | 4.5% |
| CloudWatch Logs | 750円 | 1.2% |
| その他サービス | 1,065円 | 1.7% |
| **合計** | **63,453円** | **100%** |

### Phase 2（外部公開時）追加費用

| 追加コンポーネント | 月額（円） |
|-------------------|-----------|
| AWS WAF | 500円 |
| データ転送費増加 | 2,000-5,000円 |
| **追加費用合計** | **2,500-5,500円** |
| **Phase 2 総額** | **65,953-68,953円** |

### オートスケール時の費用

| インスタンス数 | 月額費用（円） | 備考 |
|---------------|-------------|------|
| 1インスタンス | 63,453円 | MVP段階 |
| 2インスタンス | 120,261円 | 中負荷時 |
| 3インスタンス | 177,069円 | 高負荷時 |

## コスト最適化案

### 1. 開発・テスト環境での削減
- **夜間・休日停止**: 30-50%のコスト削減
- **小型インスタンス検証**: g4dn.large使用で40%削減
- **開発時のみ起動**: 週40時間稼働で75%削減

### 2. 予約インスタンス活用
```
1年契約（前払いなし）: 約30%削減
1年契約（全額前払い）: 約40%削減
3年契約（全額前払い）: 約50%削減
```

### 3. ログ・ストレージ最適化
- **ログ保持期間短縮**: 7日保持で70%削減
- **ログレベル調整**: INFO以上で50%削減
- **EBSボリューム最適化**: gp2からgp3で20%削減済み

### 4. 段階的スケーリング
```
フェーズ1（検証）: 平日日中のみ → 月額15,000円
フェーズ2（MVP）: 24時間稼働 → 月額63,500円  
フェーズ3（本格運用）: オートスケール → 月額120,000-180,000円
```

## 費用削減シミュレーション

### パターンA: 開発最適化
```
ベースライン: 63,453円/月
- 夜間停止（50%削減）: 31,726円/月
- 予約インスタンス（30%削減）: 22,208円/月
合計削減効果: 65%削減 → 月額22,208円
```

### パターンB: 本格運用最適化
```
2インスタンス稼働: 120,261円/月
- 予約インスタンス（30%削減）: 84,183円/月
- ログ最適化（20%削減）: 82,663円/月
合計削減効果: 31%削減 → 月額82,663円
```

## 注意事項・リスク

### コスト上昇要因
1. **GPU需要増加**: g4dn系インスタンスの価格変動
2. **データ転送量増加**: 外部公開時の通信費
3. **モデルサイズ増大**: EBSボリューム容量拡張
4. **スケールアウト**: 負荷増加に伴うインスタンス追加

### 想定外費用
- **NAT Gateway**: プライベートサブネット通信（月額5,000円）
- **VPC Endpoint**: S3/ECR接続最適化（月額3,000円）
- **CloudTrail**: 監査ログ（月額2,000円）

## 結論

**主要な費用構成**:
- EC2インスタンス（GPU）が全体の約90%を占める
- MVP段階で月額約63,500円、本格運用時は120,000-180,000円

**推奨アプローチ**:
1. 開発時は夜間停止でコスト削減
2. MVP段階で予約インスタンス検討
3. 段階的スケールでリスク最小化

**最終見積もり**:
- **MVP段階**: **月額63,500円**
- **本格運用**: **月額120,000-180,000円**
- **最適化後**: **月額22,000-85,000円**